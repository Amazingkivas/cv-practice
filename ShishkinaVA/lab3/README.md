# Практическая работа №3. Классификация изображений с использованием библиотеки OpenCV.

## Описание структуры программы

Программа позволяет выполнить классификацию изображений с использованием модели мешка слов с дескрипторами SIFT и ORB, а также различных алгоритмов машинного обучения для классификации. Она содержит три класса ImageLoader, FeatureExtractor, ModelTrainer, ArgumentParser.

Класс ImageLoader отвечает за загрузку изображений из указанных директорий и их изменение до единого размера.

Атрибуты класса ImageLoader:

- `image_size: кортеж, указывающий размер, до которого будут изменяться изображения.`

Методы класса ImageLoader:

- `load_images_from_folder(folder, label): загружает изображения из указанной папки и присваивает им данную метку.`

Класс FeatureExtractor обрабатывает извлечение признаков из изображений с использованием дескрипторов SIFT или ORB и строит векторы признаков с использованием подхода мешка слов.

Атрибуты класса FeatureExtractor:

- `k: количество кластеров для KMeans.`
- `kmeans: объект KMeans для кластеризации дескрипторов.`
- `detector: детектор SIFT или ORB.`


Методы класса FeatureExtractor: 

- `__init__(self, k=100, descriptor='sift'): конструктор класса, инициализирующий атрибуты k, descriptor, создает объект KMeans и соответствующий детектор.`
- `extract_features(images):  извлекает дескрипторы из изображений и возвращает список дескрипторов.`
- `build_histogram(descriptors): строит гистограмму дескрипторов на основе предсказаний KMeans.`
- `build_feature_vectors(images): строит векторы признаков для списка изображений.`
- `fit_kmeans(descriptors_list): обучает модель KMeans на извлеченных дескрипторах.`


Класс ModelTrainer отвечает за обучение модели машинного обучения на векторах признаков и оценку ее производительности.

Атрибуты класса ModelTrainer:

- `model:модель машинного обучения для обучения.`
- `scaler: StandardScaler для масштабирования векторов признаков.`

Методы класса ModelTrainer: 

- `train(X_train, y_train): обучает модель на обучающих данных.`
- `evaluate(X_test, y_test): оценивает модель`

Класс ArgumentParser обрабатывает разбор аргументов командной строки для скрипта.

Методы класса ArgumentParser: 

- `cli_argument_parser(): разбирает аргументы командной строки с использованием argparse.`

Класс Visualizer предоставляет различные методы визуализации для анализа результатов классификации.

Методы класса Visualizer: 

- `plot_sample_predictions(images, y_true, y_pred, n=100): строит сетку изображений с их истинными и предсказанными метками.`
- `visualize_features(images, detector): Визуализирует обнаруженные ключевые точки на первых 5 изображениях.`
- `plot_classification_histogram(y_true, y_pred, class_names, dataset_name): cтроит гистограмму точности классификации для каждого класса.`
- `plot_confusion_matrix(y_true, y_pred, class_names, dataset_name): строит матрицу ошибок.`
- `plot_combined_histogram(cats_descriptors, dogs_descriptors, kmeans, k, dataset_name): троит гистограмму распределения дескрипторов для кошек и собак.`
- `plot_classification_results(y_true, y_pred, class_names, dataset_name): cтроит гистограммы правильно и неправильно классифицированных изображений.`
- `plot_roc_curve(y_true, y_prob, dataset_name): строит ROC-кривую.`

Вспомогательные функции: 

- `main() - основная функция программы.`

Аргументы:
- `--mode`: Режим работы (например, train_test).
- `--train_dir`: Директория, содержащая обучающие изображения.
- `--test_dir`: Директория, содержащая тестовые изображения.
- `--n_clusters`: Количество кластеров для визуального словаря.
- `--algorithm`: Алгоритм для использования при обучении и тестировании (например, knn, svc, rf, gb).
- `--descriptor`: Дескриптор для использования (например, sift, orb).

### Главная функция программы

Код реализует процесс обучения и оценки модели классификации, которая различает изображения кошек и собак. 

Создаются экземпляры классов ImageLoader для загрузки изображений и FeatureExtractor, который отвечает за извлечение признаков из изображений. В конструктор FeatureExtractor передаются параметры, такие как количество кластеров (k) и тип дескриптора.

В зависимости от аргумента командной строки args.algorithm, выбирается один из нескольких алгоритмов классификации: K-ближайших соседей (KNN), опорные векторы (SVC), случайный лес (Random Forest) или градиентный бустинг (Gradient Boosting). Если передан неизвестный алгоритм, выбрасывается исключение.

Загружаются изображения кошек и собак из указанных директорий для обучающего и тестового наборов. Каждое изображение помечается соответствующим классом (0 для кошек и 1 для собак).

Загруженные изображения объединяются в один набор для обучения (X_train, y_train) и тестирования (X_test, y_test). После этого выводится количество загруженных изображений.

Извлекаются дескрипторы (признаки) из всех изображений в обучающем наборе с помощью метода extract_features. Затем производится обучение KMeans на этих дескрипторах, что позволяет кластеризовать признаки.

Выводится среднее количество обнаруженных ключевых точек на тренировочных изображениях.

Строится объединенная гистограмма распределения дескрипторов для кошек и собак, что позволяет визуально оценить различия между классами.

Формируются векторы признаков для обучающего и тестового наборов изображений с помощью метода build_feature_vectors. Модель обучается на созданных векторах признаков с использованием класса ModelTrainer. Оценивается точность модели на обучающем и тестовом наборах, а также выводятся отчеты о классификации, которые содержат информацию о точности, полноте и F1-мере. 

Строятся гистограммы классификации для обучающего и тестового наборов, а также визуализируются результаты правильной и неправильной классификации. Построение ROC-кривых для оценки качества классификации на обоих наборах данных.

В конце отображаются первые пять изображений из обучающего набора с наложенными на них обнаруженными дескрипторами, что позволяет визуально оценить результаты работы детектора. Также выполняется построение матрицы ошибок для оценки качества классификации модели на обучающей и тестовой выборках.